{% extends "GeneralLayoutView/GeneralSectionMusicEditorView.html.twig" %}

{% block head %}
	{{ parent() }}
	<script>
		var origin = "{{ data.origin }}";
		scoretitle = "{{ data.scoretitle }}";
		scorecomposer = "{{ data.scorecomposer }}";
		scorecategory = "{{ data.scorecategory }}";
	</script>

{% endblock %}

{% block timeline %}
	<!-- polyfill -->
	<script src="Ressources/public/js/midiFramework/inc/shim/Base64.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<!-- midi.js package -->
	<script src="Ressources/public/js/midiFramework/js/midi/audioDetect.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/js/midi/gm.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/js/midi/loader.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/js/midi/plugin.audiotag.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/js/midi/plugin.webaudio.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/js/midi/plugin.webmidi.js" type="text/javascript"></script>
	<!-- utils -->
	<script src="Ressources/public/js/midiFramework/js/util/dom_request_xhr.js" type="text/javascript"></script>
	<script src="Ressources/public/js/midiFramework/js/util/dom_request_script.js" type="text/javascript"></script>


	<div id="popup-music">
		<div><h3>Music Editor</h3></div>
		<form method="POST">
		<label for="title">Title: </label><input type="text" id="title" name="title" disabled="disabled">
		<label for="composer">Composer: </label><input type="text" id="composer" name="composer" disabled="disabled">
		<label for="composer">Category: </label><input type="text" id="category" name="category" disabled="disabled">
		<label for="nbbeats">Number of Beats: </label><input type="number" id="nbbeats" name="nbbeats">
		<label for="beats"> Beats: </label><input type="number" id="beats" name="beats">
		<input type="button" value="Continue" id="next" name="next">
		</form>
	</div>

	<div id="note"></div>
	<div id="score">
		<div id="drawing"></div>
	</div>
	<script>
		window.onload = function () {
			MIDI.loadPlugin({
				soundfontUrl: "Ressources/public/js/midi-js-soundfonts/FluidR3_GM/",
				instrument: "acoustic_grand_piano",
				onprogress: function(state, progress) {
					console.log(state, progress);
				},
				onsuccess: function() {
					var delay = 0; // play one note every quarter second
					var note = 50; // the MIDI note
					var velocity = 127; // how hard the note hits
					// play the note
					MIDI.setVolume(0, 127);
					MIDI.noteOn(0, note, velocity, delay);
					MIDI.noteOff(0, note, delay + 0.75);
					MIDI.noteOn(0, 55, velocity, delay + 1.75);
					MIDI.noteOff(0, 55, delay + 1.75);
				}
			});
		};
	</script>
{% endblock %}
